{
  "module": "planning",
  "global_status": "WARN",
  "timestamp": "2026-01-30T22:18:25.167952",
  "duration_seconds": 0.101066,
  "agents_executed": 4,
  "total_findings": {
    "CRITICAL": 0,
    "HIGH": 8,
    "MEDIUM": 27,
    "LOW": 39
  },
  "reports": [
    {
      "agent": "sqlpro",
      "status": "WARN",
      "summary": "⚠️  WARNING : 8 problème(s) haute(s) priorité DB",
      "score": {
        "db_quality": "0/10",
        "total_findings": 27
      },
      "findings_count": 27,
      "findings": [
        {
          "severity": "HIGH",
          "message": "Migration contient DROP TABLE",
          "file": "backend/migrations/versions/20260124_0001_initial_chantiers.py",
          "suggestion": "Vérifier que cette suppression est intentionnelle",
          "category": "database"
        },
        {
          "severity": "HIGH",
          "message": "Migration contient DROP TABLE",
          "file": "backend/migrations/versions/20260125_0001_add_chantier_ouvriers.py",
          "suggestion": "Vérifier que cette suppression est intentionnelle",
          "category": "database"
        },
        {
          "severity": "MEDIUM",
          "message": "DROP COLUMN sans batch_op (problème SQLite)",
          "file": "backend/migrations/versions/20260128_0001_add_rgpd_consent_fields.py",
          "suggestion": "Utiliser with batch_alter_table(...)",
          "category": "database"
        },
        {
          "severity": "HIGH",
          "message": "Migration contient DROP TABLE",
          "file": "backend/migrations/versions/20260124_0002_security_and_performance.py",
          "suggestion": "Vérifier que cette suppression est intentionnelle",
          "category": "database"
        },
        {
          "severity": "MEDIUM",
          "message": "DROP COLUMN sans batch_op (problème SQLite)",
          "file": "backend/migrations/versions/20260124_0002_security_and_performance.py",
          "suggestion": "Utiliser with batch_alter_table(...)",
          "category": "database"
        },
        {
          "severity": "HIGH",
          "message": "Migration contient DROP TABLE",
          "file": "backend/migrations/versions/20260129_0001_add_webhooks_and_event_logs.py",
          "suggestion": "Vérifier que cette suppression est intentionnelle",
          "category": "database"
        },
        {
          "severity": "MEDIUM",
          "message": "DROP COLUMN sans batch_op (problème SQLite)",
          "file": "backend/migrations/versions/20260130_2114_45fbfeb64662_add_heures_prevues_to_affectations.py",
          "suggestion": "Utiliser with batch_alter_table(...)",
          "category": "database"
        },
        {
          "severity": "HIGH",
          "message": "Migration contient DROP TABLE",
          "file": "backend/migrations/versions/20260124_0002_create_besoins_charge.py",
          "suggestion": "Vérifier que cette suppression est intentionnelle",
          "category": "database"
        },
        {
          "severity": "MEDIUM",
          "message": "DROP COLUMN sans batch_op (problème SQLite)",
          "file": "backend/migrations/versions/20260130_0001_add_maitre_ouvrage_to_chantiers.py",
          "suggestion": "Utiliser with batch_alter_table(...)",
          "category": "database"
        },
        {
          "severity": "HIGH",
          "message": "Migration contient DROP TABLE",
          "file": "backend/migrations/versions/20260128_0002_add_api_keys_table.py",
          "suggestion": "Vérifier que cette suppression est intentionnelle",
          "category": "database"
        },
        {
          "severity": "MEDIUM",
          "message": "DROP COLUMN sans batch_op (problème SQLite)",
          "file": "backend/migrations/versions/20260130_1630_670f48881d6d_add_password_reset_invitation_and_email_.py",
          "suggestion": "Utiliser with batch_alter_table(...)",
          "category": "database"
        },
        {
          "severity": "HIGH",
          "message": "Migration contient DROP TABLE",
          "file": "backend/migrations/versions/20260124_0003_logistique_schema.py",
          "suggestion": "Vérifier que cette suppression est intentionnelle",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/besoin_charge_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/besoin_charge_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/besoin_charge_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/besoin_charge_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/besoin_charge_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/besoin_charge_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/affectation_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/affectation_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/affectation_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/affectation_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/affectation_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne sans nullable défini",
          "file": "backend/modules/planning/infrastructure/persistence/affectation_model.py",
          "suggestion": "Ajouter nullable=False ou nullable=True explicitement",
          "category": "database"
        },
        {
          "severity": "HIGH",
          "message": "Risque de N+1 queries (boucle avec accès relation)",
          "file": "backend/modules/planning/infrastructure/persistence/sqlalchemy_besoin_charge_repository.py",
          "suggestion": "Utiliser joinedload() ou selectinload() pour eager loading",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne 'chantier_id' utilisée dans filter sans index apparent",
          "file": "backend/modules/planning/infrastructure/persistence/sqlalchemy_affectation_repository.py",
          "suggestion": "Vérifier si index existe sur 'chantier_id' pour optimiser les recherches",
          "category": "database"
        },
        {
          "severity": "LOW",
          "message": "Colonne 'utilisateur_id' utilisée dans filter sans index apparent",
          "file": "backend/modules/planning/infrastructure/persistence/sqlalchemy_affectation_repository.py",
          "suggestion": "Vérifier si index existe sur 'utilisateur_id' pour optimiser les recherches",
          "category": "database"
        }
      ]
    },
    {
      "agent": "architectreviewer",
      "status": "PASS",
      "summary": "✅ Architecture Clean respectée",
      "score": {
        "clean_architecture": "10/10",
        "modularity": "10/10",
        "files_analyzed": 81
      },
      "findings_count": 0,
      "findings": []
    },
    {
      "agent": "codereviewer",
      "status": "PASS",
      "summary": "✅ Code de qualité acceptable",
      "score": {
        "quality": "10/10",
        "maintainability": "0/10",
        "files_reviewed": 81,
        "issues_found": 43
      },
      "findings_count": 43,
      "findings": [
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' sans docstring Google style",
          "file": "backend/modules/planning/domain/events/affectation_cancelled.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' sans docstring Google style",
          "file": "backend/modules/planning/domain/events/affectation_updated.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' sans docstring Google style",
          "file": "backend/modules/planning/domain/events/affectation_created.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' sans docstring Google style",
          "file": "backend/modules/planning/domain/events/affectation_deleted.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction 'get_user_info' sans docstring Google style",
          "file": "backend/modules/planning/infrastructure/web/dependencies.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction 'get_chantier_info' sans docstring Google style",
          "file": "backend/modules/planning/infrastructure/web/dependencies.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' sans docstring Google style",
          "file": "backend/modules/planning/application/use_cases/charge/exceptions.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' sans docstring Google style",
          "file": "backend/modules/planning/application/use_cases/charge/exceptions.py",
          "suggestion": "Ajouter une docstring avec Args, Returns, Raises",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/events/affectation_cancelled.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/events/affectation_updated.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/events/affectation_created.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/events/affectation_deleted.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/entities/affectation.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/entities/besoin_charge.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/value_objects/charge/taux_occupation.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/domain/value_objects/charge/semaine.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/affectation_dto.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/duplicate_affectations_dto.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/create_affectation_dto.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/planning_filters_dto.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/update_affectation_dto.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/planning_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/planning_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/planning_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/planning_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/planning_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/planning_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/occupation_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/occupation_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'from' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/besoin_charge_dto.py",
          "suggestion": "Renommer en From",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/besoin_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/besoin_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "LOW",
          "message": "Classe 'class' ne suit pas PascalCase",
          "file": "backend/modules/planning/application/dtos/charge/besoin_charge_dto.py",
          "suggestion": "Renommer en Class",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (14)",
          "file": "backend/modules/planning/infrastructure/providers/affectation_provider.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (26)",
          "file": "backend/modules/planning/infrastructure/persistence/sqlalchemy_affectation_repository.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (20)",
          "file": "backend/modules/planning/infrastructure/persistence/sqlalchemy_besoin_charge_repository.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (23)",
          "file": "backend/modules/planning/application/use_cases/create_affectation.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (28)",
          "file": "backend/modules/planning/application/use_cases/get_planning.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (14)",
          "file": "backend/modules/planning/application/use_cases/resize_affectation.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (15)",
          "file": "backend/modules/planning/application/use_cases/update_affectation.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (16)",
          "file": "backend/modules/planning/application/use_cases/charge/get_planning_charge.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (12)",
          "file": "backend/modules/planning/adapters/presenters/affectation_presenter.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        },
        {
          "severity": "MEDIUM",
          "message": "Fonction '__init__' a une complexité cyclomatique élevée (15)",
          "file": "backend/modules/planning/adapters/controllers/planning_controller.py",
          "suggestion": "Refactorer en fonctions plus petites (complexité cible < 10)",
          "category": "quality"
        }
      ]
    },
    {
      "agent": "securityauditor",
      "status": "PASS",
      "summary": "✅ Aucune vulnérabilité critique détectée",
      "score": {
        "security": "10/10",
        "critical_issues": 0,
        "high_issues": 0,
        "total_findings": 4
      },
      "findings_count": 4,
      "findings": [
        {
          "severity": "MEDIUM",
          "message": "Endpoint sans validation Pydantic stricte",
          "file": "backend/modules/planning/infrastructure/web/charge_routes.py",
          "suggestion": "Utiliser des modèles Pydantic avec validators",
          "category": "security"
        },
        {
          "severity": "MEDIUM",
          "message": "Endpoint sans validation Pydantic stricte",
          "file": "backend/modules/planning/infrastructure/web/planning_routes.py",
          "suggestion": "Utiliser des modèles Pydantic avec validators",
          "category": "security"
        },
        {
          "severity": "MEDIUM",
          "message": "RGPD : Droit d'accès aux données non implémenté",
          "file": "backend/modules/planning",
          "suggestion": "Implémenter l'export des données utilisateur",
          "category": "security"
        },
        {
          "severity": "MEDIUM",
          "message": "RGPD : Droit à l'oubli non implémenté",
          "file": "backend/modules/planning",
          "suggestion": "Implémenter la suppression complète des données",
          "category": "security"
        }
      ]
    }
  ]
}